/* Generated by GOB (v2.0.6) on Wed Jan 21 20:02:05 2004
   (do not edit directly) */

/* End world hunger, donate to the World Food Programme, http://www.wfp.org */

#define GOB_VERSION_MAJOR 2
#define GOB_VERSION_MINOR 0
#define GOB_VERSION_PATCHLEVEL 6

#define selfp (self->_priv)

#include <string.h> /* memset() */

#include "xfce-mixer-profiles.h"

#include "xfce-mixer-profiles-private.h"

#ifdef G_LIKELY
#define ___GOB_LIKELY(expr) G_LIKELY(expr)
#define ___GOB_UNLIKELY(expr) G_UNLIKELY(expr)
#else /* ! G_LIKELY */
#define ___GOB_LIKELY(expr) (expr)
#define ___GOB_UNLIKELY(expr) (expr)
#endif /* G_LIKELY */

#line 1 "mixer-profiles.gob"

#include <gtk/gtk.h>
#include "xfce-mixer-profile.h"
#include "xfce-mixer-pxml.h"

#line 33 "xfce-mixer-profiles.c"

#line 6 "mixer-profiles.gob"

#include <libxfce4util/util.h>
#include <libxfce4util/i18n.h>

#define PROFILES_ROOT "Profiles"
#ifndef MAX_PATH
#define MAX_PATH 4096
#endif

static void profiles_free (GList *profiles)
{
	GList *g;
	g = profiles;
	while (g) {
		g_object_unref (G_OBJECT (g->data));
		g = g_list_next (g);
	}
	g_list_free (profiles);
}


#line 57 "xfce-mixer-profiles.c"
/* self casting macros */
#define SELF(x) XFCE_MIXER_PROFILES(x)
#define SELF_CONST(x) XFCE_MIXER_PROFILES_CONST(x)
#define IS_SELF(x) XFCE_IS_MIXER_PROFILES(x)
#define TYPE_SELF XFCE_TYPE_MIXER_PROFILES
#define SELF_CLASS(x) XFCE_MIXER_PROFILES_CLASS(x)

#define SELF_GET_CLASS(x) XFCE_MIXER_PROFILES_GET_CLASS(x)

/* self typedefs */
typedef XfceMixerProfiles Self;
typedef XfceMixerProfilesClass SelfClass;

/* here are local prototypes */
static void xfce_mixer_profiles_class_init (XfceMixerProfilesClass * c) G_GNUC_UNUSED;
static void xfce_mixer_profiles_init (XfceMixerProfiles * self) G_GNUC_UNUSED;

/* pointer to the class of our parent */
static GObjectClass *parent_class = NULL;

/* Short form macros */
#if defined(__GNUC__) && !defined(__STRICT_ANSI__)
#define self_clear(args...) xfce_mixer_profiles_clear(args)
#define self_get_profile_names(args...) xfce_mixer_profiles_get_profile_names(args)
#define self_goto_device(args...) xfce_mixer_profiles_goto_device(args)
#define self_load(args...) xfce_mixer_profiles_load(args)
#define self_xml_text_child(args...) xfce_mixer_profiles_xml_text_child(args)
#define self_save(args...) xfce_mixer_profiles_save(args)
#define self_add_profile(args...) xfce_mixer_profiles_add_profile(args)
#define self_get_profile(args...) xfce_mixer_profiles_get_profile(args)
#define self_delete_profile(args...) xfce_mixer_profiles_delete_profile(args)
#define self_set_modified(args...) xfce_mixer_profiles_set_modified(args)
#define self_get_modified(args...) xfce_mixer_profiles_get_modified(args)
#define self_new(args...) xfce_mixer_profiles_new(args)
#endif /* __GNUC__ && !__STRICT_ANSI__ */

/* Short form pointers */
static void (* const self_clear) (XfceMixerProfiles * self) = xfce_mixer_profiles_clear;
static GList * (* const self_get_profile_names) (XfceMixerProfiles * self) = xfce_mixer_profiles_get_profile_names;
static void (* const self_goto_device) (XfceMixerProfiles * self) = xfce_mixer_profiles_goto_device;
static void (* const self_load) (XfceMixerProfiles * self) = xfce_mixer_profiles_load;
static void (* const self_xml_text_child) (XfceMixerProfiles * self, gchar const * tagname) = xfce_mixer_profiles_xml_text_child;
static void (* const self_save) (XfceMixerProfiles * self) = xfce_mixer_profiles_save;
static void (* const self_add_profile) (XfceMixerProfiles * self, XfceMixerProfile * pn) = xfce_mixer_profiles_add_profile;
static XfceMixerProfile * (* const self_get_profile) (XfceMixerProfiles * self, gchar const * name) = xfce_mixer_profiles_get_profile;
static void (* const self_delete_profile) (XfceMixerProfiles * self, gchar const * name) = xfce_mixer_profiles_delete_profile;
static void (* const self_set_modified) (XfceMixerProfiles * self, gboolean modi) = xfce_mixer_profiles_set_modified;
static gboolean (* const self_get_modified) (XfceMixerProfiles * self) = xfce_mixer_profiles_get_modified;
static XfceMixerProfiles * (* const self_new) (gchar const * device) = xfce_mixer_profiles_new;

GType
xfce_mixer_profiles_get_type (void)
{
	static GType type = 0;

	if ___GOB_UNLIKELY(type == 0) {
		static const GTypeInfo info = {
			sizeof (XfceMixerProfilesClass),
			(GBaseInitFunc) NULL,
			(GBaseFinalizeFunc) NULL,
			(GClassInitFunc) xfce_mixer_profiles_class_init,
			(GClassFinalizeFunc) NULL,
			NULL /* class_data */,
			sizeof (XfceMixerProfiles),
			0 /* n_preallocs */,
			(GInstanceInitFunc) xfce_mixer_profiles_init,
		};

		type = g_type_register_static (G_TYPE_OBJECT, "XfceMixerProfiles", &info, (GTypeFlags)0);
	}

	return type;
}

/* a macro for creating a new object of our type */
#define GET_NEW ((XfceMixerProfiles *)g_object_new(xfce_mixer_profiles_get_type(), NULL))

/* a function for creating a new object of our type */
#include <stdarg.h>
static XfceMixerProfiles * GET_NEW_VARG (const char *first, ...) G_GNUC_UNUSED;
static XfceMixerProfiles *
GET_NEW_VARG (const char *first, ...)
{
	XfceMixerProfiles *ret;
	va_list ap;
	va_start (ap, first);
	ret = (XfceMixerProfiles *)g_object_new_valist (xfce_mixer_profiles_get_type (), first, ap);
	va_end (ap);
	return ret;
}


static void
___dispose (GObject *obj_self)
{
#define __GOB_FUNCTION__ "Xfce:Mixer:Profiles::dispose"
	XfceMixerProfiles *self = XFCE_MIXER_PROFILES (obj_self);
	if (G_OBJECT_CLASS (parent_class)->dispose) \
		(* G_OBJECT_CLASS (parent_class)->dispose) (obj_self);
#line 39 "mixer-profiles.gob"
	if(self->xml) { ((*(void (*)(void *))g_object_unref)) (self->xml); self->xml = NULL; }
#line 159 "xfce-mixer-profiles.c"
	return;
	self = NULL;
}
#undef __GOB_FUNCTION__


static void
___finalize(GObject *obj_self)
{
#define __GOB_FUNCTION__ "Xfce:Mixer:Profiles::finalize"
	XfceMixerProfiles *self = XFCE_MIXER_PROFILES (obj_self);
	if(G_OBJECT_CLASS(parent_class)->finalize) \
		(* G_OBJECT_CLASS(parent_class)->finalize)(obj_self);
#line 30 "mixer-profiles.gob"
	if(self->device) { ((*(void (*)(void *))g_free)) (self->device); self->device = NULL; }
#line 175 "xfce-mixer-profiles.c"
#line 32 "mixer-profiles.gob"
	if(self->fname) { ((*(void (*)(void *))g_free)) (self->fname); self->fname = NULL; }
#line 178 "xfce-mixer-profiles.c"
#line 36 "mixer-profiles.gob"
	if(self->profiles) { ((*(void (*)(void *))profiles_free)) (self->profiles); self->profiles = NULL; }
#line 181 "xfce-mixer-profiles.c"
	return;
	self = NULL;
}
#undef __GOB_FUNCTION__

static void 
xfce_mixer_profiles_class_init (XfceMixerProfilesClass * c)
{
#define __GOB_FUNCTION__ "Xfce:Mixer:Profiles::class_init"
	GObjectClass *g_object_class = (GObjectClass*) c;

	parent_class = g_type_class_ref (G_TYPE_OBJECT);

	g_object_class->dispose = ___dispose;
	g_object_class->finalize = ___finalize;
	return;
	c = NULL;
	g_object_class = NULL;
}
#undef __GOB_FUNCTION__
#line 41 "mixer-profiles.gob"
static void 
xfce_mixer_profiles_init (XfceMixerProfiles * self)
#line 205 "xfce-mixer-profiles.c"
{
#define __GOB_FUNCTION__ "Xfce:Mixer:Profiles::init"
#line 6 "mixer-profiles.gob"
	self->device = NULL;
#line 210 "xfce-mixer-profiles.c"
#line 6 "mixer-profiles.gob"
	self->fname = NULL;
#line 213 "xfce-mixer-profiles.c"
#line 6 "mixer-profiles.gob"
	self->modified = FALSE;
#line 216 "xfce-mixer-profiles.c"
#line 6 "mixer-profiles.gob"
	self->weird_number = 0;
#line 219 "xfce-mixer-profiles.c"
#line 6 "mixer-profiles.gob"
	self->profiles = NULL;
#line 222 "xfce-mixer-profiles.c"
#line 6 "mixer-profiles.gob"
	self->xml = NULL;
#line 225 "xfce-mixer-profiles.c"
 {
#line 42 "mixer-profiles.gob"

		self->fname = xfce_get_userfile ("xfce4-mixer", "profiles.xml", NULL);
		self->xml = xfce_mixer_pxml_new (PROFILES_ROOT);
		g_object_set (G_OBJECT (self->xml), "fname", self->fname, NULL);
	
#line 233 "xfce-mixer-profiles.c"
 }
	return;
	self = NULL;
}
#undef __GOB_FUNCTION__



#line 48 "mixer-profiles.gob"
void 
xfce_mixer_profiles_clear (XfceMixerProfiles * self)
#line 245 "xfce-mixer-profiles.c"
{
#define __GOB_FUNCTION__ "Xfce:Mixer:Profiles::clear"
#line 48 "mixer-profiles.gob"
	g_return_if_fail (self != NULL);
#line 48 "mixer-profiles.gob"
	g_return_if_fail (XFCE_IS_MIXER_PROFILES (self));
#line 252 "xfce-mixer-profiles.c"
{
#line 49 "mixer-profiles.gob"
	
		profiles_free (self->profiles);
		self->weird_number = 0;
		self->profiles = NULL;
	}}
#line 260 "xfce-mixer-profiles.c"
#undef __GOB_FUNCTION__

#line 55 "mixer-profiles.gob"
GList * 
xfce_mixer_profiles_get_profile_names (XfceMixerProfiles * self)
#line 266 "xfce-mixer-profiles.c"
{
#define __GOB_FUNCTION__ "Xfce:Mixer:Profiles::get_profile_names"
#line 55 "mixer-profiles.gob"
	g_return_val_if_fail (self != NULL, (GList * )0);
#line 55 "mixer-profiles.gob"
	g_return_val_if_fail (XFCE_IS_MIXER_PROFILES (self), (GList * )0);
#line 273 "xfce-mixer-profiles.c"
{
#line 56 "mixer-profiles.gob"
	
		GList *g;
		GList *gn;
		XfceMixerProfile *p;
		gchar const *so;
		gn = NULL;
		g = self->profiles;
		while (g) {
			p = XFCE_MIXER_PROFILE (g->data);
			so = xfce_mixer_profile_get_title (p);

			gn = g_list_append (gn, g_strdup (so));

			g = g_list_next (g);
		}

		return gn;
	}}
#line 294 "xfce-mixer-profiles.c"
#undef __GOB_FUNCTION__

#line 75 "mixer-profiles.gob"
void 
xfce_mixer_profiles_goto_device (XfceMixerProfiles * self)
#line 300 "xfce-mixer-profiles.c"
{
#define __GOB_FUNCTION__ "Xfce:Mixer:Profiles::goto_device"
#line 75 "mixer-profiles.gob"
	g_return_if_fail (self != NULL);
#line 75 "mixer-profiles.gob"
	g_return_if_fail (XFCE_IS_MIXER_PROFILES (self));
#line 307 "xfce-mixer-profiles.c"
{
#line 76 "mixer-profiles.gob"
	
		gchar *n;
		xfce_mixer_pxml_goto_root (self->xml);
		xfce_mixer_pxml_goto_children (self->xml);
		while (self->xml->node) {
			if (xfce_mixer_pxml_check_tag (self->xml, "device")) {
				n = xfce_mixer_pxml_get_prop (self->xml, "name");
				if (n && self->device && g_str_equal (n, self->device)) {
					g_free (n);
					return;
				}
				if (n)
					g_free (n);
			}

			xfce_mixer_pxml_goto_next (self->xml);
		}

		/* device does not exist yet in xml */
		self->xml->node = NULL;
		xfce_mixer_pxml_goto_root (self->xml);
		self->xml->node = xfce_mixer_pxml_create_text_child (self->xml, "device", NULL);
		xfce_mixer_pxml_set_prop (self->xml, "name", self->device);
	}}
#line 334 "xfce-mixer-profiles.c"
#undef __GOB_FUNCTION__

#line 101 "mixer-profiles.gob"
void 
xfce_mixer_profiles_load (XfceMixerProfiles * self)
#line 340 "xfce-mixer-profiles.c"
{
#define __GOB_FUNCTION__ "Xfce:Mixer:Profiles::load"
#line 101 "mixer-profiles.gob"
	g_return_if_fail (self != NULL);
#line 101 "mixer-profiles.gob"
	g_return_if_fail (XFCE_IS_MIXER_PROFILES (self));
#line 347 "xfce-mixer-profiles.c"
{
#line 102 "mixer-profiles.gob"
	
		gchar *n;
		XfceMixerProfile *p;
		self_clear (self);
		self_goto_device (self);

		xfce_mixer_pxml_goto_children (self->xml);
		while (self->xml->node) {
			if (xfce_mixer_pxml_check_tag (self->xml, "profile")) {
				n = xfce_mixer_pxml_get_prop (self->xml, "name");
				if (n) {
					p = XFCE_MIXER_PROFILE (xfce_mixer_profile_new (n));
					if (p) {
						/* TODO read data etc */
					}
				}
			}

			xfce_mixer_pxml_goto_next (self->xml);
		}

	}}
#line 372 "xfce-mixer-profiles.c"
#undef __GOB_FUNCTION__

#line 125 "mixer-profiles.gob"
void 
xfce_mixer_profiles_xml_text_child (XfceMixerProfiles * self, gchar const * tagname)
#line 378 "xfce-mixer-profiles.c"
{
#define __GOB_FUNCTION__ "Xfce:Mixer:Profiles::xml_text_child"
#line 125 "mixer-profiles.gob"
	g_return_if_fail (self != NULL);
#line 125 "mixer-profiles.gob"
	g_return_if_fail (XFCE_IS_MIXER_PROFILES (self));
#line 385 "xfce-mixer-profiles.c"
{
#line 126 "mixer-profiles.gob"
	
		self->xml->node = xfce_mixer_pxml_create_text_child (self->xml, tagname, NULL);
	}}
#line 391 "xfce-mixer-profiles.c"
#undef __GOB_FUNCTION__

#line 130 "mixer-profiles.gob"
void 
xfce_mixer_profiles_save (XfceMixerProfiles * self)
#line 397 "xfce-mixer-profiles.c"
{
#define __GOB_FUNCTION__ "Xfce:Mixer:Profiles::save"
#line 130 "mixer-profiles.gob"
	g_return_if_fail (self != NULL);
#line 130 "mixer-profiles.gob"
	g_return_if_fail (XFCE_IS_MIXER_PROFILES (self));
#line 404 "xfce-mixer-profiles.c"
{
#line 131 "mixer-profiles.gob"
	
		xmlNodePtr profilesx;
		XfceMixerProfile *p;
		GList *g;
		gchar const *n;
		if (!self_get_modified (self))
			return;

		xfce_mixer_pxml_goto_root (self->xml);
		self_goto_device (self);

		profilesx = self->xml->node;

		xfce_mixer_pxml_eat_children (self->xml, NULL);

		g = self->profiles;
		while (g) {
			p = XFCE_MIXER_PROFILE (g->data);

			n = xfce_mixer_profile_get_title (p);
			xfce_mixer_pxml_goto_node (self->xml, profilesx);
			self_xml_text_child (self, "profile");
			xfce_mixer_pxml_set_prop (self->xml, "name", n);

			/* TODO save actual data */

			g = g_list_next (g);
		}

		self_set_modified (self, FALSE);
	}}
#line 438 "xfce-mixer-profiles.c"
#undef __GOB_FUNCTION__

#line 163 "mixer-profiles.gob"
void 
xfce_mixer_profiles_add_profile (XfceMixerProfiles * self, XfceMixerProfile * pn)
#line 444 "xfce-mixer-profiles.c"
{
#define __GOB_FUNCTION__ "Xfce:Mixer:Profiles::add_profile"
#line 163 "mixer-profiles.gob"
	g_return_if_fail (self != NULL);
#line 163 "mixer-profiles.gob"
	g_return_if_fail (XFCE_IS_MIXER_PROFILES (self));
#line 451 "xfce-mixer-profiles.c"
{
#line 164 "mixer-profiles.gob"
	
		XfceMixerProfile *p;
		gchar const *fixedname;
		gchar tmp[MAX_PATH];
		if (!pn)
			return;

		fixedname = xfce_mixer_profile_get_title (pn);

		if (fixedname)
			g_snprintf (tmp, MAX_PATH, "%s", fixedname);
		else
			g_snprintf (tmp, MAX_PATH, _("profile%d"), ++self->weird_number);

		/* check if name is a dupe */

		p = self_get_profile (self, tmp);
		if (p) {
			g_object_unref (G_OBJECT (p));
			g_snprintf (tmp, MAX_PATH, _("profile%d"), ++self->weird_number);

			p = self_get_profile (self, tmp);
			if (p) { /* hmpf. */
				g_object_unref (G_OBJECT (p));
				return;
			}
		}
	}}
#line 482 "xfce-mixer-profiles.c"
#undef __GOB_FUNCTION__

#line 200 "mixer-profiles.gob"
XfceMixerProfile * 
xfce_mixer_profiles_get_profile (XfceMixerProfiles * self, gchar const * name)
#line 488 "xfce-mixer-profiles.c"
{
#define __GOB_FUNCTION__ "Xfce:Mixer:Profiles::get_profile"
#line 200 "mixer-profiles.gob"
	g_return_val_if_fail (self != NULL, (XfceMixerProfile * )0);
#line 200 "mixer-profiles.gob"
	g_return_val_if_fail (XFCE_IS_MIXER_PROFILES (self), (XfceMixerProfile * )0);
#line 495 "xfce-mixer-profiles.c"
{
#line 201 "mixer-profiles.gob"
	
		GList *g;
		gchar const *s;
		g = self->profiles;
		if (!name)
			return NULL;

		while (g) {
			s = xfce_mixer_profile_get_title (XFCE_MIXER_PROFILE (g->data));
			if (s) {
				if (g_str_equal (s, name)) {
					g_object_ref (G_OBJECT (g->data));
					return XFCE_MIXER_PROFILE (g->data);
				}
			}
			g = g_list_next (g);
		}

		return NULL;
	}}
#line 518 "xfce-mixer-profiles.c"
#undef __GOB_FUNCTION__

#line 222 "mixer-profiles.gob"
void 
xfce_mixer_profiles_delete_profile (XfceMixerProfiles * self, gchar const * name)
#line 524 "xfce-mixer-profiles.c"
{
#define __GOB_FUNCTION__ "Xfce:Mixer:Profiles::delete_profile"
#line 222 "mixer-profiles.gob"
	g_return_if_fail (self != NULL);
#line 222 "mixer-profiles.gob"
	g_return_if_fail (XFCE_IS_MIXER_PROFILES (self));
#line 531 "xfce-mixer-profiles.c"
{
#line 223 "mixer-profiles.gob"
	
		XfceMixerProfile *p;
		if (!name)
			return;

		p = self_get_profile (self, name);
		if (p) {
			g_object_unref (G_OBJECT (p));
			g_object_unref (G_OBJECT (p));
			self->profiles = g_list_remove (self->profiles, p);
		}
	}}
#line 546 "xfce-mixer-profiles.c"
#undef __GOB_FUNCTION__

#line 236 "mixer-profiles.gob"
void 
xfce_mixer_profiles_set_modified (XfceMixerProfiles * self, gboolean modi)
#line 552 "xfce-mixer-profiles.c"
{
#define __GOB_FUNCTION__ "Xfce:Mixer:Profiles::set_modified"
#line 236 "mixer-profiles.gob"
	g_return_if_fail (self != NULL);
#line 236 "mixer-profiles.gob"
	g_return_if_fail (XFCE_IS_MIXER_PROFILES (self));
#line 559 "xfce-mixer-profiles.c"
{
#line 237 "mixer-profiles.gob"
	
		self->modified = modi;
	}}
#line 565 "xfce-mixer-profiles.c"
#undef __GOB_FUNCTION__

#line 241 "mixer-profiles.gob"
gboolean 
xfce_mixer_profiles_get_modified (XfceMixerProfiles * self)
#line 571 "xfce-mixer-profiles.c"
{
#define __GOB_FUNCTION__ "Xfce:Mixer:Profiles::get_modified"
#line 241 "mixer-profiles.gob"
	g_return_val_if_fail (self != NULL, (gboolean )0);
#line 241 "mixer-profiles.gob"
	g_return_val_if_fail (XFCE_IS_MIXER_PROFILES (self), (gboolean )0);
#line 578 "xfce-mixer-profiles.c"
{
#line 242 "mixer-profiles.gob"
	
		return self->modified;
	}}
#line 584 "xfce-mixer-profiles.c"
#undef __GOB_FUNCTION__

#line 246 "mixer-profiles.gob"
XfceMixerProfiles * 
xfce_mixer_profiles_new (gchar const * device)
#line 590 "xfce-mixer-profiles.c"
{
#define __GOB_FUNCTION__ "Xfce:Mixer:Profiles::new"
{
#line 247 "mixer-profiles.gob"
	
		XfceMixerProfiles *p;
		p = XFCE_MIXER_PROFILES (GET_NEW);
		p->device = g_strdup (device);
		return p;
	}}
#line 601 "xfce-mixer-profiles.c"
#undef __GOB_FUNCTION__


#if (!defined __GNUC__) || (defined __GNUC__ && defined __STRICT_ANSI__)
/*REALLY BAD HACK
  This is to avoid unused warnings if you don't call
  some method.  I need to find a better way to do
  this, not needed in GCC since we use some gcc
  extentions to make saner, faster code */
static void
___xfce_mixer_profiles_really_bad_hack_to_avoid_warnings(void)
{
	((void (*)(void))GET_NEW_VARG)();
	((void (*)(void))self_clear)();
	((void (*)(void))self_get_profile_names)();
	((void (*)(void))self_goto_device)();
	((void (*)(void))self_load)();
	((void (*)(void))self_xml_text_child)();
	((void (*)(void))self_save)();
	((void (*)(void))self_add_profile)();
	((void (*)(void))self_get_profile)();
	((void (*)(void))self_delete_profile)();
	((void (*)(void))self_set_modified)();
	((void (*)(void))self_get_modified)();
	((void (*)(void))self_new)();
	___xfce_mixer_profiles_really_bad_hack_to_avoid_warnings();
}
#endif /* !__GNUC__ || (__GNUC__ && __STRICT_ANSI__) */

